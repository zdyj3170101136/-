#### 通信（ipc）

管道

两个文件描述符。

这两个文件描述符指向同一个节点

其中一个读端，一个写端。

读和写之间通过互斥锁协调。



#### 无名

f d[0]读，f d[1]写，通常在父子进程间通信间单向通信

fork返回的pid大于-表示父进程。

#### 有名

任意两个进程间交换数据。

两个点一个是是否阻塞。

一个是数据

当 open 一个FIFO时，是否设置非阻塞标志（`O_NONBLOCK`）的区别：

- 若没有指定`O_NONBLOCK`（默认），只读 open 要阻塞到某个其他进程为写而打开此 FIFO。类似的，只写 open 要阻塞到某个其他进程为读而打开它。
- 若指定了`O_NONBLOCK`，则只读 open 立即返回。而只写 open 将出错返回 -1 如果没有进程已经为读而打开该 FIFO，其errno置ENXIO。



https://segmentfault.com/a/1190000009528245



在go语言里面。管道通过共享两个chan实现。



一个write chan是[]byte。

写端把[]byte通过writechan传送。

然后读端通过copy从write chan返回的[]byte切片，保存到传进来的byte切片中。

通过read chan的int chan返回读取的字节流。



然后还有一个sturct {}的done chan，当关闭的时候就会close（）。

则读端和写端，都无法再调用，因为直接返回了。

![截屏2020-07-10 下午4.05.36](/Users/jieyang/Library/Application Support/typora-user-images/截屏2020-07-10 下午4.05.36.png)

![截屏2020-07-10 下午4.00.39](/Users/jieyang/Library/Application Support/typora-user-images/截屏2020-07-10 下午4.00.39.png)

![截屏2020-07-10 下午3.59.42](/Users/jieyang/Library/Application Support/typora-user-images/截屏2020-07-10 下午3.59.42.png)

#### 信号量

信号量通常用一组数字表示。

数字表示资源。

释放信号量表示增加资源，然后唤醒一个阻塞的线程。

获取信号量表示减少数字，如果数字为零，那么就阻塞在信号量上。



增加和减少信号量就通过mutex串行化。



信号量通常通过随机二叉树生成。

treap是一棵二叉搜索树，

按照数字的地址进行排序。

但是每个节点都有一个优先级（随机化），并且优先级是最小堆。

(Int32)

引入优先级防止它退化成一条链表，影响查找速率。

[https://www.lizhechen.com/2017/02/18/%E6%95%B0%E6%8D%AE%E7%BB%93%E6%9E%84%E2%80%94%E2%80%94%E5%B9%B3%E8%A1%A1%E6%A0%91%20Treap/](https://www.lizhechen.com/2017/02/18/数据结构——平衡树 Treap/)





**共享内存（Shared Memory）**，指两个或多个进程共享一个给定的存储区。

### 1、特点

1. 共享内存是最快的一种 IPC，因为进程是直接对内存进行存取。
2. 因为多个进程可以同时操作，所以需要进行同步。
3. 信号量+共享内存通常结合在一起使用，信号量用来同步对共享内存的访问。

https://songlee24.github.io/2015/04/21/linux-IPC/

#### 线程通信

互斥锁

信号量

读写锁

