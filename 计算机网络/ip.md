## ip

#### dhcp

客户在端口67通过udp发送该报文。

使用广播目的地址255.255.255.255.和本主机ip地址0.0.0.0.

广播到所有与该链路连接到的节点。

- dhcp服务器收到dhcp报文后，使用广播ip地址255.255.255.255回复。

包括向客户推荐的ip，网眼掩码以及地址有效期。

- 客户向选定的dhcp服务器发送dhcp请求报文
- dhcp服务器发送ack报文。



#### 输入url到地

首先当我们把电脑和网络连接时。（获得ip地址）

- 生成dhcp请求报文，从目的端口67和源端口68的udp报文段，放到具有广播目的地址255.255.255.255，源目的地址0.0.0.0的ip数据报中
- 包含dhcp请求报文的ip地址被放置在以太网帧中，具有目的mac地址FF:FF:FF:FF， 我的电脑的mac地址,因此以太网服务器把这个以太网帧广播
- 路由器从它连接到以太网的端口接受到以太网帧，因此dhcp服务器收到后就返回ip地址以及dns服务器的ip地址还有默认网关路由器的ip地址。发送回去
- 然后交换机的子学习特性让它直接能够把对应的以太网帧传给我的电脑
- 我的电脑记录网关的ip地址，dns服务器的ip地址，自己的ip地址

（获得网关路由器的mac地址）

- 生成dns查询报文，放到目的端口号54（dns协议）
- 但是现在它还不知道网关路由器的mac地址，因此运行arp协议
- 生成一个具有广播目的地址fffffffff的mac向交换机询问
- 交换机转发给所有的设备
- 网关路由器收到arp请求后，把自己的mac地址回复。

（tcp连接）

- 然后我们就可以发送dns查询报文，当网关收到查询报文后，就通过转发表转发，而它的转发表通过狱内协议OSPF以及狱间协议bgp填写。
- 一般来讲dns服务器慧直接缓存有对应的ip地址，然后回答。



- 最后生成对目的端口80的tcp握手报文（https则是443）

- 如果是ssl的话，得先发送ssl报文

  

#### ip和tcp只校验首部

ip是有个live字段，防止没经过一个路由器就减一。



https://zhidao.baidu.com/question/621694585768681252.html