## UDP

UDP由于不保存连接状态，立即发送（TCP会把数据保存在缓冲区，时不时取一些出来发送），无连接状态（发送和接收缓冲各种参数），首部开销小（8字节）。



更适合实时应用。

用于DNS中



16 位源端口号 ｜ 16位目的端口号

16位（首部+数据）长度 ｜ 检验和

#### 区别

1. TCP面向连接，UDP面向非连接即发送数据前不需要建立链接
2. udp立即发送，tcp保存在缓冲区合适的时候再发送。
3. TCP提供可靠的服务（数据传输），UDP无法保证
4. udp首部开销小，只有8个字节。
5. TCP面向字节流，UDP面向报文（tcp会对报文的字节计数会拆分合并报文，udp不会）
6. TCP数据传输比UDP慢
7. 在一个TCP连接中，仅有两方进行彼此通信，因此广播和多播不能用于TCP
8. TCP使用校正和，确认和重传机制，累积确认，来保证可靠传输，使用滑动窗口机制来实现流量控制，udp校验和可选

#### quic

由于tcp的滑动窗口特性，这种有着前后顺序的包之间。

将会存在队头阻塞特性。

https://xiaozhuanlan.com/topic/2083674195

#### 避免队头阻塞

quic通过RAID5.

当发送五个数据包时在发送前五个包的异或结果。

这样任意一个包丢失都能够重新恢复数据。

通过这种形式基本避免了重发数据的情况。



丢了两个包以上还是会重传。

#### 0 - rtt

当发送sync报文的时候同时发送一个sessionid。

而sessionid是上次握手成功后，服务器返回的上下文标记。

这样在tcp阶段就可以实现0-rtt延迟。



![截屏2020-07-09 下午7.42.31](/Users/jieyang/Library/Application Support/typora-user-images/截屏2020-07-09 下午7.42.31.png)

#### 为什么要基于udp

- tcp由操作系统实现，改进困难

- 很多路由器只识别tcp和udp

  

#### 第一次连接

客户端发送一个hello。

服务端返回一个syncookie。

一次rtt

https://www.jianshu.com/p/bb3eeb36b479

#### 快速重启会话

手机端的时候，如果网络改变会改变ip地址这时候tcp会话会重启。

但是udp使用uuid标志连接，不惜要重新握手。

